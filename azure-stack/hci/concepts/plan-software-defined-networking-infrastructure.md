---
title: ソフトウェア定義ネットワーク インフラストラクチャを計画する
description: このトピックでは、ソフトウェア定義ネットワーク (SDN) インフラストラクチャの展開を計画する方法について説明します。
manager: grcusanz
ms.topic: conceptual
ms.assetid: ea7e53c8-11ec-410b-b287-897c7aaafb13
ms.author: anpaul
author: AnirbanPaul
ms.date: 10/28/2020
ms.openlocfilehash: d75e22814afcb9610bdd1f9af3824d3e12e3199b
ms.sourcegitcommit: 296c95cad20ed62bdad0d27f1f5246bfc1c81d5e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2020
ms.locfileid: "93064567"
---
# <a name="plan-a-software-defined-network-infrastructure"></a>ソフトウェア定義ネットワーク インフラストラクチャを計画する

>適用対象:Azure Stack HCI バージョン 20H2、Windows Server 2019、Windows Server (半期チャネル)、Windows Server 2016

ソフトウェア定義ネットワーク (SDN) インフラストラクチャの展開計画 (ハードウェアとソフトウェアの前提条件を含む) について説明します。 このトピックでは、物理および論理ネットワークの構成、ルーティング、ゲートウェイ、ネットワーク ハードウェアなどの計画要件について説明します。 また、SDN インフラストラクチャの拡張と段階的展開の使用に関する考慮事項も示します。

   > [!NOTE]
   > SDN は、ストレッチ (マルチサイト) クラスターではサポートされていません。

## <a name="prerequisites"></a>前提条件
SDN インフラストラクチャには、次のようなハードウェアとソフトウェアの前提条件があります。
- **セキュリティ グループと動的 DNS 登録** 。 ネットワーク コントローラーを展開するためにデータセンターを準備する必要があります。これには、一連の仮想マシン (VM) が必要です。 ネットワーク コントローラーを展開する前に、セキュリティ グループと動的 DNS の登録を構成する必要があります。

    データセンター用のネットワーク コントローラーの展開について詳しくは、「[ネットワーク コントローラーを展開するための要件](/windows-server/networking/sdn/plan/installation-and-preparation-requirements-for-deploying-network-controller)」を参照してください。

- **物理ネットワーク** 。 仮想ローカル エリア ネットワーク (VLAN)、ルーティング、Border Gateway Protocol (BGP) を構成するために、物理ネットワーク デバイスにアクセスする必要があります。 このトピックでは、手動でスイッチを構成する手順について説明し、さらにレイヤー 3 スイッチ/ルーターで BGP ピアリングを使用するオプション、またはルーティングとリモート アクセス サーバー (RRAS) VM を使用するオプションについて説明します。

- **物理コンピューティング ホスト** 。 これらのホストは Hyper-V を実行し、SDN インフラストラクチャとテナント VM をホストするために必要です。 「[SDN ハードウェア要件](system-requirements.md#sdn-hardware-requirements)」セクションで説明されているように、これらのホストで最適なパフォーマンスを得るには、特定のネットワーク ハードウェアが必要です。

## <a name="physical-and-logical-network-configuration"></a>物理および論理ネットワークの構成
各物理コンピューティング ホストでは、物理スイッチ ポートに接続された 1 つ以上のネットワーク アダプターを介したネットワーク接続が必要です。 レイヤー 2 [VLAN](https://en.wikipedia.org/wiki/Virtual_LAN) は、複数の論理ネットワーク セグメントに分割されたネットワークをサポートします。

>[!TIP]
>アクセス モードまたはタグなしで論理ネットワークに VLAN 0 を使用します。

>[!IMPORTANT]
>Windows Server 2016 のソフトウェア定義ネットワークでは、アンダーレイとオーバーレイに対して IPv4 アドレスがサポートされています。 IPv6 はサポートされていません。 Windows Server 2019 では、IPv4 と IPv6 の両方のアドレス指定がサポートされています。

### <a name="logical-networks"></a>Logical networks
このセクションでは、管理論理ネットワークと Hyper-V ネットワーク仮想化 (HNV) プロバイダーの論理ネットワーク用の SDN インフラストラクチャを計画するための要件について説明します。 ゲートウェイとソフトウェア ロード バランサー (SLB)、サンプル ネットワーク トポロジを使用するための追加の論理ネットワークのプロビジョニングについても詳しく説明します。

#### <a name="management-and-hnv-provider"></a>管理および HNV プロバイダー
すべての物理コンピューティング ホストは、管理論理ネットワークと HNV プロバイダーの論理ネットワークにアクセスする必要があります。 IP アドレスを計画する目的で、各物理コンピューティング ホストには、管理論理ネットワークの IP アドレスを少なくとも 1 つ割り当てる必要があります。 ネットワーク コントローラーには、Representational State Transfer (REST) IP アドレスとして機能する、このネットワークの予約済み IP アドレスが必要です。

HNV プロバイダー ネットワークは、East/West (内部 - 内部) テナント トラフィック、North/South (外部 - 内部) テナント トラフィック用の基礎となる物理ネットワークとして機能し、BGP ピアリング情報を物理ネットワークと交換します。

DHCP サーバーでは管理ネットワークの IP アドレスを自動的に割り当てることができます。または、静的 IP アドレスを手動で割り当てることもできます。 SDN スタックにより、個々の Hyper-V ホストに対して、HNV プロバイダーの論理ネットワークの IP アドレスが IP アドレス プールから自動的に割り当てられます。 ネットワーク コントローラーにより、IP アドレス プールが指定され、管理されます。

>[!NOTE]
>ネットワーク コントローラー ホスト エージェントによって特定のテナント VM のネットワーク ポリシーが受信された後でのみ、ネットワーク コントローラーによって HNV プロバイダーの IP アドレスが物理コンピューティング ホストに割り当てられます。

| 条件                                                    | 結果                                               |
| :------------------------------------------------------- | :---------------------------------------------------- |
| 論理ネットワークで VLAN を使用する場合                          | 物理コンピューティング ホストを、VLAN にアクセスできるトランク スイッチ ポートに接続する必要があります。 コンピューター ホスト上の物理ネットワーク アダプター上に、アクティブな VLAN フィルターがあってはならないことに注意する必要があります。|
| スイッチ埋め込みチーミング (SET) を使用し、ネットワーク アダプターなどの複数のネットワーク インターフェイス カード (NIC) チーム メンバーが存在する場合| その特定ホストのすべての NIC チーム メンバーを同じレイヤー 2 ブロードキャスト ドメインに接続する必要があります。|
| 物理コンピューティング ホストで、ネットワーク コントローラー、SLB/マルチプレクサー (MUX)、ゲートウェイなどの追加のインフラストラクチャ VM を実行する場合 | 管理論理ネットワークに、ホスト対象の各 VM のための十分な IP アドレスがあることを確認します。 また、HNV プロバイダーの論理ネットワークに、各 SLB/MUX およびゲートウェイ インフラストラクチャ VM に割り当てる十分な IP アドレスがあることを確認します。 IP 予約はネットワーク コントローラーによって管理されますが、使用できないことが原因で新しい IP アドレスの予約が失敗すると、ネットワークで IP アドレスの重複が発生する可能性があります。|

Microsoft SDN 展開でネットワークを仮想化するために使用できる Hyper-V ネットワーク仮想化 (HNV) について詳しくは、「[Hyper-V ネットワーク仮想化](/windows-server/networking/sdn/technologies/hyper-v-network-virtualization/hyper-v-network-virtualization)」を参照してください。

#### <a name="gateways-and-the-software-load-balancer-slb"></a>ゲートウェイとソフトウェア ロード バランサー (SLB)
ゲートウェイと SLB を使用するには、追加の論理ネットワークを作成してプロビジョニングする必要があります。 これらのネットワークの正しい IP プレフィックス、VLAN ID、ゲートウェイ IP アドレスを必ず取得してください。

|                                |                     |
| :----------------------------- | :------------------ |
| **パブリック VIP 論理ネットワーク** | パブリック仮想 IP (VIP) 論理ネットワークでは、クラウド環境の外部でルーティング可能な (通常、インターネットでルーティング可能な) IP サブネット プレフィックスを使用する必要があります。 これらは、サイト間ゲートウェイのフロントエンド VIP など、外部クライアントが仮想ネットワーク内のリソースにアクセスするために使用するフロントエンド IP アドレスです。 このネットワークに VLAN を割り当てる必要はありません。 |
| **プライベート VIP 論理ネットワーク** | プライベート VIP 論理ネットワークは、クラウドの外部でルーティング可能にする必要ありません。 これを使用するのは、内部クラウド クライアントからアクセスできる VIP のみであるためです (プライベート サービスなど)。 このネットワークに VLAN を割り当てる必要はありません。 |
| **GRE VIP 論理ネットワーク** | Generic Routing Encapsulation (GRE) VIP ネットワークは、VIP を定義するためだけに存在するサブネットです。 VIP は、サイト間 (S2S) GRE の接続の種類用に SDN ファブリックで実行されているゲートウェイ VM に割り当てられます。 物理スイッチやルーターでこのネットワークを事前に構成する必要はなく、また VLAN を割り当てる必要もありません。 |

#### <a name="sample-network-topology"></a>ネットワーク トポロジーのサンプル
ご使用の環境に合わせて IP サブネット プレフィックスと VLAN ID のサンプルを変更してください。

| ネットワーク名 | Subnet | マスク | トランクの VLAN ID | Gateway | 予約 (例) |
| :----------------------- | :------------ | :------- | :---------------------------- | :-------------- | :------------------------------------------- |
| 管理              | 10.184.108.0 |    24   |          7                   | 10.184.108.1   | 10.184.108.1 - ルーター<br> 10.184.108.4 - ネットワーク コントローラー<br> 10.184.108.10 - コンピューティング ホスト 1<br> 10.184.108.11 - コンピューティング ホスト 2<br> 10.184.108.X - コンピューティング ホスト X |
| HNV プロバイダー             |  10.10.56.0  |    23    |          11                |  10.10.56.1    | 10.10.56.1 - ルーター<br> 10.10.56.2 - SLB/MUX1<br> 10.10.56.5 - ゲートウェイ 1 |
| パブリック VIP               |  41.40.40.0  |    27    |          N/A                |  41.40.40.1    | 41.40.40.1 - ルーター<br> 41.40.40.3 - IPSec S2S VPN VIP |
| プライベート VIP              |  20.20.20.0  |    27    |          N/A                |  20.20.20.1    | 20.20.20.1 - 既定の GW (ルーター) |
| GRE VIP                  |  31.30.30.0  |    24    |          N/A                |  31.30.30.1    | 31.30.30.1 - 既定の GW |

## <a name="routing-infrastructure"></a>ルーティング インフラストラクチャ
VIP サブネットのルーティング情報 \(次ホップなど\) は、SLB/MUX およびリモート アクセス サーバー (RAS) ゲートウェイによって、内部 BGP ピアリングを使用して物理ネットワークにアドバタイズされます。 VIP 論理ネットワークには、VLAN は割り当てられず、レイヤー 2 スイッチ (Top-of-Rack スイッチなど) で事前に構成されません。

SLB/MUX と RAS ゲートウェイによってアドバタイズされる VIP 論理ネットワークのルートを受信するために、SDN インフラストラクチャで使用される BGP ピアをルーターで作成する必要があります。 BGP ピアリングは、一方向 (SLB/MUX または RAS ゲートウェイから外部 BGP ピア) でのみ実行する必要があります。 ルーティングの最初のレイヤーの上で、静的ルートまたは Open Shortest Path First (OSPF) などの別の動的ルーティング プロトコルを使用できます。 ただし、前述のように、VIP 論理ネットワークの IP サブネット プレフィックスは、物理ネットワークから外部 BGP ピアにルーティングできる必要があります。

BGP ピアリングは、通常、ネットワーク インフラストラクチャの一部として、マネージド スイッチまたはルーターで構成されます。 BGP ピアは、ルーティング専用モードで RAS ロールがインストールされている Windows Server でも構成できます。 ネットワーク インフラストラクチャ内の BGP ルーター ピアは、独自の自律システム番号 (ASN) を使用するように構成する必要があります。また、SDN コンポーネントの \(SLB/MUX および RAS ゲートウェイ\)に割り当てられる ASN からのピアリングを許可するように構成する必要があります。

物理ルーターから、またはそのルーターを管理するネットワーク管理者から次の情報を取得する必要があります。
- ルーター ASN
- ルーターの IP アドレス

>[!NOTE]
>SLB/MUX では、4 バイトの ASN はサポートされません。 SLB/MUX と、その接続先のルーターに 2 バイトの ASN を割り当てる必要があります。 ご使用の環境内の他の場所では 4 バイトの ASN を使用できます。

ユーザーまたはネットワーク管理者は、RAS ゲートウェイと SLB MUX が使用する HNV プロバイダー論理ネットワークの ASN および IP アドレスまたはサブネット アドレスからの接続を受け入れるように BGP ルーター ピアを構成する必要があります。

詳細については、「[Border Gateway Protocol (BGP)](/windows-server/remote/remote-access/bgp/border-gateway-protocol-bgp)」を参照してください。

## <a name="default-gateways"></a>既定のゲートウェイ
物理ホスト、SLB/MUX、ゲートウェイ VM など、複数のネットワークに接続するように構成されたマシンでは、既定のゲートウェイを 1 つだけ構成する必要があります。 ホストとインフラストラクチャ VM には、次の既定のゲートウェイを使用します。
- Hyper-V ホストでは、既定のゲートウェイとして管理ネットワークを使用します。
- ネットワーク コントローラー VM では、既定のゲートウェイとして管理ネットワークを使用します。
- SLB/MUX VM では、既定のゲートウェイとして管理ネットワークを使用します。
- ゲートウェイ VM では、既定のゲートウェイとして HNV プロバイダー ネットワークを使用します。 これは、ゲートウェイ VM のフロントエンド NIC で設定する必要があります。

## <a name="switches-and-routers"></a>スイッチとルーター
物理スイッチまたはルーターの構成を支援するために、さまざまなスイッチ モデルおよびベンダーの一連のサンプル構成ファイルが [Microsoft SDN GitHub リポジトリ](https://github.com/microsoft/SDN/tree/master/SwitchConfigExamples)にあります。 特定のスイッチに関する Readme ファイルおよびテスト済みのコマンド ライン インターフェイス (CLI) コマンドが用意されています。

スイッチとルーターの要件について詳しくは、「[SDN ハードウェア要件](system-requirements.md#sdn-hardware-requirements)」を参照してください。

## <a name="compute"></a>Compute
すべての Hyper-V ホストは、適切なオペレーティング システムがインストールされ、Hyper-V に対して有効にされている必要があります。また、少なくとも 1 つの物理アダプターが管理論理ネットワークに接続された外部 Hyper-V 仮想スイッチを使用する必要があります。 管理ホスト vNIC に割り当てられている管理 IP アドレスを使用して、ホストに到達できる必要があります。

Hyper-V、共有、またはローカルと互換性のある任意の種類のストレージを使用できます。

> [!TIP]
> すべての仮想スイッチに同じ名前を使用すると便利ですが、必須ではありません。 スクリプトを使用して展開する予定の場合は、config.psd1 ファイル内の `vSwitchName` 変数に関連付けられているコメントを参照してください。

### <a name="host-compute-requirements"></a>ホスト コンピューティングの要件
次に示すのは、この例の展開で使用されている 4 台の物理ホストのハードウェアとソフトウェアの最小要件です。

Host|ハードウェア要件|ソフトウェア要件|
--------|-------------------------|-------------------------
|物理 Hyper-V ホスト|4 コア 2.66 GHz CPU<br> 32 GB の RAM<br> 300 GB のディスク領域<br> 1 GB/秒 (以上) の物理ネットワーク アダプター|オペレーティング システム:このトピックの冒頭にある「適用対象」で<br> 定義されているとおり。<br> Hyper-V ロールがインストールされている。|

### <a name="sdn-infrastructure-vm-role-requirements"></a>SDN インフラストラクチャの VM ロールの要件
VM ロールの要件を次に示します。

ロール|vCPU 要件|メモリ要件|ディスクの要件|
--------|-----------------------------|-----------------------|--------------------------
|ネットワーク コントローラー (3 つのノード)|4 つの vCPU|4 GB 以上<br> (8 GB 推奨)|オペレーティング システム ドライブ用に 75 GB
|SLB/MUX (3 つのノード)|8 vCPU|8 GB 推奨|オペレーティング システム ドライブ用に 75 GB
|RAS ゲートウェイ<br> (3 つのノード ゲートウェイ<br> (2 つアクティブで 1 つパッシブ) の単一プール)|8 vCPU|8 GB 推奨|オペレーティング システム ドライブ用に 75 GB
|SLB/MUX ピアリング用の<br> RAS ゲートウェイ BGP ルーター<br> (または ToR スイッチを<br> BGP ルーターとして使用)|2 つの vCPU|2 GB|オペレーティング システム ドライブ用に 75 GB|

展開のために System Center - Virtual Machine Manager (VMM) を使用する場合、VMM およびその他の非 SDN インフラストラクチャのために、追加のインフラストラクチャ VM リソースが必要になります。 詳細については、「[System Center Virtual Machine Manager のシステム要件](/system-center/vmm/system-requirements?preserve-view=true&view=sc-vmm-2019)」を参照してください。

## <a name="extending-your-infrastructure"></a>インフラストラクチャの拡張
インフラストラクチャのサイズとリソースの要件は、ホストする予定のテナント ワークロード VM によって異なります。 インフラストラクチャ VM の CPU、メモリ、ディスクの要件 (たとえば、ネットワーク コントローラー、SLB、ゲートウェイなど) は、前の表で定義されています。 必要に応じて、スケーリングのためにインフラストラクチャ VM を追加できます。 ただし、Hyper-V ホストで実行されるすべてのテナント VM について、独自の CPU、メモリ、ディスク要件を考慮する必要があります。

テナント ワークロード VM が物理 Hyper-V ホスト上のリソースを過剰に消費するようになった場合、物理ホストを追加してインフラストラクチャを拡張できます。 Windows Admin Center、VMM、PowerShell スクリプトのいずれかを使用して、ネットワーク コントローラー経由で新しいサーバー リソースを作成できます。 使用する方法は、最初にインフラストラクチャを展開した方法によって異なります。 HNV プロバイダー ネットワーク用に IP アドレスを追加する必要がある場合は、ホストが使用できる (対応する IP プールを備えた) 新しい論理サブネットを作成できます。

## <a name="phased-deployment"></a>段階的展開
要件によっては、SDN インフラストラクチャのサブセットを展開することが必要になる場合があります。 たとえば、データセンター内の顧客ワークロードのみホストする必要があり、外部通信が必要ない場合は、ネットワーク コントローラーを展開して、SLB/MUX とゲートウェイ VM の展開をスキップできます。 次に、SDN インフラストラクチャを段階的に展開するためのネットワーク機能インフラストラクチャの要件について説明します。

機能|展開の要件|ネットワークの要件|
--------|-------------------------|-------------------------
|論理ネットワークの管理<br> アクセス制御リスト (ACL) (VLAN ベースのネットワーク用)<br> サービスの品質 (QoS) (VLAN ベースのネットワーク用)<br>|ネットワーク コントローラー|None|
|仮想ネットワーク<br> ユーザー定義ルーティング<br> ACL (仮想ネットワーク用)<br> 暗号化されたサブネット<br> QoS (仮想ネットワーク用)<br> 仮想ネットワーク ピアリング|ネットワーク コントローラー|HNV PA VLAN、サブネット、ルーター|
|受信/送信 NAT<br> 負荷分散|ネットワーク コントローラー<br> SLB/MUX|HNV PA ネットワーク上の BGP<br> プライベートおよびパブリック VIP サブネット|
|GRE ゲートウェイ接続|ネットワーク コントローラー<br> Gateway|HNV PA ネットワーク上の BGP<br> GRE VIP サブネット|
|IPSec ゲートウェイ接続|ネットワーク コントローラー<br> SLB/MUX<br> Gateway|HNV PA ネットワーク上の BGP<br> パブリック VIP サブネット|
|L3 ゲートウェイ接続|ネットワーク コントローラー<br> Gateway|テナント VLAN、サブネット、ルーター<br> テナント VLAN 上の BGP (オプション)。|

## <a name="next-steps"></a>次のステップ
関連情報については、以下もご覧ください。
- [ネットワーク コントローラーを展開するための要件](/windows-server/networking/sdn/plan/installation-and-preparation-requirements-for-deploying-network-controller)
- [Azure Stack HCI における SDN](./software-defined-networking.md)