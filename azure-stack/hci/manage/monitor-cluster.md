---
title: Azure Stack HCI クラスターを監視する
description: Windows Admin Center と PowerShell を使用して、Azure Stack HCI クラスター、サーバー、仮想マシン、ドライブ、ボリュームを監視する方法について説明します。
author: khdownie
ms.author: v-kedow
ms.topic: how-to
ms.service: azure-stack
ms.subservice: azure-stack-hci
ms.date: 08/12/2020
ms.openlocfilehash: 9ce1dc258243e9e17458c1f70e5a852a0b56996a
ms.sourcegitcommit: a3e042c782a38ecf3baf7a64b1d492a655972f9a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2020
ms.locfileid: "88202047"
---
# <a name="monitor-azure-stack-hci-clusters"></a>Azure Stack HCI クラスターを監視する

> 適用対象:Azure Stack HCI バージョン 20H2、Windows Server 2019

Azure Stack HCI クラスターとその基になるコンポーネントを監視する 3 つの方法として、Windows Admin Center、[Azure Monitor](azure-monitor.md)、PowerShell があります。

## <a name="monitor-using-windows-admin-center-dashboard"></a>Windows Admin Center ダッシュボードを使用して監視する

管理用の PC またはサーバーに [Windows Admin Center をインストール](/windows-server/manage/windows-admin-center/deploy/install)し、監視したい Azure Stack HCI クラスターを追加して、そのクラスターに接続します。 ログインするとすぐに、Windows Admin Center ダッシュボードの上部には重要なアラートが目立つように表示されます。 たとえば、次のスクリーンショットは、更新プログラムをインストールする必要があることと、クラスターに重大なドライブ エラーがあることを示しています。

:::image type="content" source="media/monitor-cluster/dashboard-alert.png" alt-text="Windows Admin Center ダッシュボードのアラートの例":::

## <a name="monitor-virtual-machines"></a>仮想マシンの監視

アプリケーションやデータベースが動作している仮想マシン (VM) の正常性を把握することは重要です。 ワークロードを実行できるだけの CPU やメモリが VM に割り当てられていない場合は、パフォーマンスが低下したり、アプリケーションが利用できなくなったりする可能性があります。 ハートビートに対する VM の応答が 5 分以上の間に 3 回を下回った場合は、問題が生じている可能性があります。

Windows Admin Center で VM を監視するには、左側の **[ツール]** メニューから **[仮想マシン]** をクリックします。 クラスターで実行されている VM の完全なインベントリを表示するには、ページ上部にある **[インベントリ]** をクリックします。 以下のように、各 VM に関する情報を含むテーブルが表示されます。

- **[名前]:** VM の名前。
- **状態:** VM が実行されているか停止しているかを示します。
- **ホスト サーバー:** VM がクラスター内のどのサーバーで実行されているかを示します。
- **CPU 使用率:** クラスターの合計 CPU リソースのうち、VM によって使用されている割合。
- **メモリ負荷:** 使用可能なメモリ リソースのうち、VM によって使用されている割合。
- **必要なメモリ:** 割り当てられているメモリのうち、VM によって使用されている量 (GB または MB)。
- **割り当てられているメモリ:** VM に割り当てられているメモリの総量。
- **アップタイム:** VM が実行されている時間 (日:時間:分:秒)。
- **ハートビート:** クラスターが VM と通信できるかどうかを示します。
- **ディザスター リカバリーの状態:** VM が Azure Site Recovery にサインインしているかどうかを示します。

## <a name="monitor-servers"></a>サーバーの監視

Azure Stack HCI クラスターを構成するホスト サーバーを Windows Admin Center から直接監視できます。 ホスト サーバーは VM に必要なリソースを提供するのに十分な CPU やメモリで構成されていない場合、パフォーマンスのボトルネックになる可能性があります。 

Windows Admin Center でサーバーを監視するには、左側の **[ツール]** メニューから **[サーバー]** をクリックします。 クラスターに含まれるサーバーの完全なインベントリを表示するには、ページ上部にある **[インベントリ]** をクリックします。 以下のように、各サーバーに関する情報を含むテーブルが表示されます。

- **[名前]:** クラスター内のホスト サーバーの名前。
- **状態:** サーバーが稼動しているかダウンしているかを示します。
- **アップタイム:** サーバーの稼動時間。
- **製造元:** サーバーのハードウェア製造元。
- **モデル:** サーバーのモデル。
- **シリアル番号:** サーバーのシリアル番号。
- **CPU 使用率:** ホスト サーバーの CPU の使用されている割合。 クラスター内のどのサーバーでも、CPU 使用率が 85% を上回る状態が 10 分を超えて続かないようにしてください。 
- **メモリ使用量**: ホスト サーバーのメモリの使用されている割合。 10 分以上の間、サーバーの使用可能なメモリが 100 MB を下回る場合は、メモリの増設を検討してください。

## <a name="monitor-volumes"></a>ボリュームを監視する

記憶域ボリュームはすぐにいっぱいになる場合があるため、アプリケーションへの影響を避けるために、それらを定期的に監視することが重要となります。 Windows Admin Center でボリュームを監視するには、左側の **[ツール]** メニューから **[ボリューム]** をクリックします。 クラスター上の記憶域ボリュームの完全なインベントリを表示するには、ページ上部にある **[インベントリ]** をクリックします。 以下のように、各ボリュームに関する情報を含むテーブルが表示されます。

- **[名前]:** ボリュームの名前。
- **状態:** "OK" は、そのボリュームが正常であることを示します。それ以外の場合は、警告またはエラーがレポートされます。
- **ファイル システム:** ボリュームのファイル システム (ReFS、CSVFS)。
- **回復性:** ボリュームが双方向ミラー、3 方向ミラー、またはミラー高速パリティのうちどれであるかを示します。
- **Size:** ボリュームのサイズ (TB または GB)
- **記憶域プール:** ボリュームが属している記憶域プール。
- **記憶域の利用状況:** ボリュームのストレージ容量の使用されている割合。
- **IOPS:** 1 秒あたりの入出力処理の数。

## <a name="monitor-drives"></a>ドライブを監視する

Azure Stack HCI では、個々のドライブが失われてもクラスターに重大な影響が及ばないよう、ストレージが仮想化されます。 ただし、故障したドライブは[交換する必要があります](replace-drives.md)。また、空き容量が不足したり待ち時間が長くなったりするとドライブがパフォーマンスに影響を及ぼす可能性があります。 オペレーティング システムがドライブと通信できない場合、ドライブが緩んでいる (または外れている) か、そのコネクタで障害が発生しているか、またはドライブ自体が故障している可能性があります。 通信が途絶えてから 15 分が経過したドライブは、Windows によって自動的にインベントリから削除されます。 

Windows Admin Center でドライブを監視するには、左側の **[ツール]** メニューから **[ドライブ]** をクリックします。 クラスター上のドライブの完全なインベントリを表示するには、ページ上部にある **[インベントリ]** をクリックします。 以下のように、各ドライブに関する情報を含むテーブルが表示されます。

- **シリアル番号:** ドライブのシリアル番号。
- **状態:** "OK" は、そのドライブが正常であることを示します。それ以外の場合は、警告またはエラーがレポートされます。
- **モデル:** ドライブのモデル。
- **Size:** ドライブの合計容量 (TB または GB)。
- **種類:** ドライブの種類 (SSD、HDD)。
- **使用目的:** ドライブの使用目的がキャッシュであるか容量であるかを示します。
- **[場所]:** ドライブの接続先である記憶域アダプターとポート。
- **サーバー:** ドライブの接続先であるサーバーの名前。
- **記憶域プール:** ドライブが属している記憶域プール。
- **記憶域の利用状況:** ドライブのストレージ容量の使用されている割合。

## <a name="add-performance-counters"></a>パフォーマンス カウンターを追加する

Windows、アプリ、またはデバイスのパフォーマンス カウンターをリアルタイムで表示して比較するには、Windows Admin Center のパフォーマンス モニター ツールを使用します。

1. 左側の **[ツール]** メニューから **[パフォーマンス モニター]** を選択します。
1. **[Blank workspace]\(空のワークスペース\)** をクリックして新しいワークスペースを開始するか、 **[Restore previous]\(以前のものを復元\)** をクリックして以前のワークスペースを復元します。
1. 新しいワークスペースを作成する場合は、 **[Add counter]\(カウンターの追加\)** ボタンをクリックし、監視する 1 つ以上のソース サーバーを選択するか、クラスター全体を選択します。
1. 監視するオブジェクトとインスタンス、およびカウンターとグラフの種類を選択して、動的なパフォーマンス情報を表示します。
1. 上部のメニューから **[保存] > [名前を付けて保存]** を選択して、ワークスペースを保存します。
 
たとえば、次のスクリーンショットは、"メモリ使用量" というパフォーマンス カウンターを示したもので、2 ノード クラスター全体のメモリに関する情報が表示されます。

:::image type="content" source="media/monitor-cluster/performance-monitor.png" alt-text="Windows Admin Center のリアルタイム パフォーマンス カウンターの例":::

## <a name="query-and-process-performance-history-with-powershell"></a>PowerShell でパフォーマンス履歴を照会して処理する

クラスターとそのコンポーネントに関する情報を返す PowerShell コマンドレットを使用して Azure Stack HCI クラスターを監視することもできます。 「[記憶域スペース ダイレクトのパフォーマンス履歴](/windows-server/storage/storage-spaces/performance-history)」を参照してください。

## <a name="use-the-health-service-feature"></a>ヘルス サービス機能を使用する

クラスター上のヘルス サービス エラーは、どのようなものであれ調査する必要があります。 レポートを実行して障害を特定する方法については、「[Windows Server でのヘルスサービス](/windows-server/failover-clustering/health-service-overview)」を参照してください。

## <a name="troubleshoot-health-and-operational-states"></a>正常性状態と操作状態のトラブルシューティングを行う

記憶域プール、仮想ディスク、ドライブの正常性状態と操作状態については、「[記憶域スペースのトラブルシューティングと、正常性と動作状態の記憶域スペース ダイレクト](/windows-server/storage/storage-spaces/storage-spaces-states)」を参照してください。

## <a name="monitor-performance-using-storage-qos"></a>記憶域 QoS を使用してパフォーマンスを監視する

記憶域 QoS (サービスの品質) は、VM のストレージ I/O を一元的に監視および管理して、"迷惑な隣人" 問題を軽減し、一貫したパフォーマンスを提供する手段となります。 「[記憶域のサービスの品質 (QoS)](/windows-server/storage/storage-qos/storage-qos-overview)」を参照してください。

## <a name="set-up-alerts-in-azure-monitor"></a>Azure Monitor でアラートを設定する

Azure Stack HCI が Azure Monitor と統合されると、ユーザーは[アラートを設定](azure-monitor.md#setting-up-alerts-using-windows-admin-center)することで、CPU、ディスク容量、メモリ使用率のしきい値を超えた場合、VM のハートビートが返されない場合、またはシステムの重大なエラーやヘルス サービス エラーが発生した場合に通知を受けることができます。

## <a name="next-steps"></a>次のステップ

関連情報については、以下も参照してください。

- [Azure Stack HCI と Windows Admin Center の使用を開始する](../get-started.md)
- [Azure Monitor を使用して Azure Stack HCI を監視する](azure-monitor.md)