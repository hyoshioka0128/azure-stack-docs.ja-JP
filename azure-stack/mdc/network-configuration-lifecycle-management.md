---
title: MDC ネットワーク構成のライフサイクル管理
description: Azure Modular Datacenter のネットワーク構成のライフサイクル管理について説明します。
author: PatAltimore
ms.author: patricka
ms.service: azure-stack
ms.topic: conceptual
ms.date: 01/02/2020
ms.lastreviewed: 01/02/2020
ms.openlocfilehash: 5453738374f9377645a6ba594dda08b8668931fe
ms.sourcegitcommit: 733a22985570df1ad466a73cd26397e7aa726719
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/05/2021
ms.locfileid: "97872332"
---
# <a name="configuration-lifecycle-management"></a>構成のライフサイクル管理

この記事では、Azure Modular Datacenter のネットワーク構成のライフサイクル管理について説明します。

## <a name="update-configuration"></a>構成を更新する

フィールド内のスイッチ構成を更新するこの方法は、すべての種類の構成更新に適用されます。 お客様または OEM によって適用された手動の構成など、多くの不明な変数がコントロールの外部にあるため、この手動プロセスには複数の手順があります。 現時点では、アップタイムは保証されていません。 更新は、メンテナンス期間中に実行することをお勧めします。

1. edge1、edge2、tor1、tor2、および BMC スイッチの現在の構成ファイルのバックアップを作成します。 これらのファイルをスイッチからコピーします。

1. 既存の構成のツールキットのビルド番号をメモします。 すべての構成で、この番号を **motd** バナーに含める必要があります。 **BUILDNUMBER** を検索します

1. 手順 2 と同じツールキット バージョンを使用して、初期構成を再生成します。

1. 手順 3 の構成をそれぞれのスイッチに読み込みます。 このポイントは、ベースラインを取得するために、スイッチを介してツールによって生成された構成を "*洗う*" ことです。 このアクションは、OEM のラボのように、OEM によって別のハードウェア上で実行される場合や、お客様と共にオンサイトで実行される場合があります。

1. 手順 4 の構成ファイルのバックアップを作成します。 それをリモートの場所にコピーします。

1. 選択した差分ツールを使用して、手順 1 の現在の構成のバックアップと手順 5 のベースライン構成のバックアップを比較します。 デバイスごとに、アップグレードされたスイッチ構成に引き継ぐ必要があるすべての相違点をメモまたはコピーします。

1. 更新されたスイッチ構成を生成する新しいツールキットを実行します。

1. 手順 6 の相違点を新しいスイッチ構成にマージします。

1. それぞれのスイッチに新しい構成を読み込みます。 ツールの出力ディレクトリで、用意されている検証後コマンドを実行します。

1. 構成を保存します。

## <a name="ntp"></a>NTP

Azure Stack でのタイム サーバーを更新するには、特権エンドポイント (PEP) を使用できます。 2 つ以上の ネットワーク タイム プロトコル (NTP) サーバーの IP アドレスに解決されるホスト名を使用します。

Azure Stack では、NTP を使用して、インターネット上のタイム サーバーに接続します。 NTP サーバーからは、正確なシステム時刻が提供されます。 時刻は、Azure Stack の物理ネットワーク スイッチ、ハードウェア ライフサイクル ホスト、インフラストラクチャ サービス、および仮想マシン間で使用されます。 クロックが同期されていない場合、Azure Stack では、ネットワークと認証に関する重大な問題が発生する可能性があります。 ログ ファイル、ドキュメント、およびその他のファイルが、不正確なタイムスタンプによって作成される可能性があります。

Azure Stack で時刻を同期するには、タイム サーバー (NTP) を 1 つ指定する必要があります。 Azure Stack をデプロイするときに、NTP サーバーのアドレスを指定します。 時刻は、重要なデータセンター インフラストラクチャ サービスです。 サービスが変更された場合は、時刻を更新する必要があります。

Azure Stack では、時刻を同期できるタイム サーバー (NTP) は 1 つだけです。 Azure Stack で時刻を同期する NTP を複数指定することはできません。 複数の NTP サーバーに解決されるドメイン ネーム システム (DNS) エントリを設定することをお勧めします。

### <a name="update-ntp-post-deployment"></a>デプロイ後の NTP を更新する

1. PEP に接続します。 ロックを解除するためにサポート チケットを開く必要はありません。

1. 次のコマンドを実行して、現在構成されている NTP サーバーを確認します。

    ```powershell
    Get-AzsTimeSource
    ```

1. 次のコマンドを実行して、新しい NTP サーバーを使用するように Azure Stack を更新し、時刻を直ちに同期します。

    ```powershell
    Set-AzsTimeSource -Timeserver NEWTIMESERVER -resync
    ```

>[!NOTE]
>この手順では、物理スイッチ上のタイム サーバーは更新されません。

## <a name="dns"></a>DNS

このセクションでは、外部名を解決するために DNS フォワーダーを更新する方法について説明します。

### <a name="update-the-dns-forwarder-in-azure-stack"></a>Azure Stack の DNS フォワーダーを更新する

Azure Stack インフラストラクチャで外部名を解決するには、少なくとも 1 つの到達可能な DNS フォワーダーが必要です。 Azure Stack のデプロイには、DNS フォワーダーを用意する必要があります。 その入力が Azure Stack の内部 DNS サーバーでフォワーダーとして使用され、認証、Marketplace 管理、使用などのサービスの外部名の解決が可能になります。

DNS は、変更可能な重要なデータセンター インフラストラクチャ サービスです。 変更する場合は、Azure Stack を更新する必要があります。

この記事では、PEP を使用して Azure Stack の DNS フォワーダーを更新する方法について説明します。 2 つの信頼できる DNS フォワーダー IP アドレスを使用することをお勧めします。

1. PEP に接続します。 PEP のロックを解除するためにサポート チケットを開く必要はありません。

1. 次のコマンドを実行して、現在構成されている DNS フォワーダーを確認します。 別の方法として、管理ポータルのリージョンのプロパティを使用することもできます。

    ```powershell
    Get-AzsDnsForwarder 
    ```

1. 次のコマンドを実行して、新しい DNS フォワーダーを使用するように Azure Stack を更新します。

    ```powershell
    Set-AzsDnsForwarder -IPAddress "IPAddress 1", "IPAddress 2"
    ```

1. エラーが発生した場合は、コマンドの出力を確認してください。
