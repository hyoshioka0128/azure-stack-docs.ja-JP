---
title: Azure Stack Hub にデプロイされた VM の保護
description: データ損失や計画外のダウンタイムから Azure Stack Hub にデプロイされた VM を保護するための復旧計画の作成方法について説明します。
author: mattbriggs
ms.topic: conceptual
ms.date: 5/27/2020
ms.author: mabrigg
ms.reviewer: hectorl
ms.lastreviewed: 3/5/2020
ms.openlocfilehash: 5634cd783a010f5aa45de88ba923dfe6a8378c4c
ms.sourcegitcommit: 4af79f4fa2598d57c81e994192c10f8c6be5a445
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/10/2020
ms.locfileid: "89742716"
---
# <a name="protect-vms-deployed-on-azure-stack-hub"></a>Azure Stack Hub にデプロイされた VM の保護

この記事は、ユーザーによって Azure Stack Hub にデプロイされた IaaS 仮想マシン (VM) に対するデータ保護とディザスター リカバリー戦略を策定するためのガイドとして使用してください。

データ損失や長期のダウンタイムから保護するために、ユーザー アプリケーションとそのデータのバックアップと回復またはディザスター リカバリー計画を実装します。 各アプリケーションは、組織の包括的なビジネス継続性およびディザスター リカバリー (BC/DR) 戦略の一環として評価する必要があります。 最初に、「[Azure Stack Hub: Considerations for business continuity and disaster recovery](https://aka.ms/azurestackbcdrconsiderationswp)」を参照することをお勧めします。

## <a name="considerations-for-protecting-iaas-vms"></a>IaaS VM の保護に関する考慮事項

### <a name="roles-and-responsibilities"></a>ロールと責任

まず、保護と復旧に関連して、アプリケーションの所有者とオペレーターに帰属するロールと責任について明確に理解していることを確認します。

ユーザーには VM を保護する責任があります。 オペレーターには、Azure Stack Hub をオンラインかつ正常な状態に保つ責任があります。 Azure Stack Hub には、インフラストラクチャ サービスから内部サービス データをバックアップするサービスが含まれていますが、ユーザーが作成した VM、ユーザーまたはアプリケーション データを持つストレージ アカウント、ユーザー データベースなどのユーザー データは**含まれていません**。


| アプリケーションの所有者/アーキテクト   | Azure Stack Hub オペレーター  |
|---    |---    |
| <ul><li>アプリケーション アーキテクチャをクラウド設計の原則に合わせる。</li></br><li>必要に応じて従来のアプリケーションを最新化し、クラウド環境用に準備する。</li></br><li>アプリケーションの許容される RTO と RPO を定義する。</li></br><li>保護する必要があるアプリケーション リソースとデータ リポジトリを特定する。</li></br><li>アプリケーション アーキテクチャと顧客の要件に最適なデータとアプリケーションの復旧方法を実装する。</li></ul>     | <ul><li>組織の事業継続とディザスター リカバリーの目標を特定する。</li></br><li>組織の BC/DR 目標を達成するのに十分な Azure Stack Hub インスタンスをデプロイする。</li></br><li>アプリケーション/データ保護インフラストラクチャを設計および運用する。</li></br><li>保護サービスへのマネージド ソリューションまたはセルフサービス アクセスを提供する。</li></br><li>アプリケーションの所有者/アーキテクトと協力して、アプリケーション設計を理解し、保護戦略を推奨する。</li></br><li>サービス復旧とクラウド復旧のためのインフラストラクチャ バックアップを有効にする。</li></ul>    |

## <a name="sourcetarget-combinations"></a>ソースとターゲットの組み合わせ

データセンターまたはサイトの停止から保護する必要があるユーザーは、別の Azure Stack Hub や Azure を使用して、高可用性や迅速な回復を実現することができます。 ユーザーは、プライマリとセカンダリの場所を使用して、アクティブ/アクティブまたはアクティブ/パッシブの構成でアプリケーションを 2 つの環境にデプロイできます。 重要度の低いワークロードについては、ユーザーはセカンダリの場所の容量を使用して、アプリケーションをバックアップからオンデマンドで復元することができます。

1 つまたは複数の Azure Stack Hub クラウドをデータセンターにデプロイできます。 壊滅的な災害を乗り切るために、少なくとも 1 つの Azure Stack Hub クラウドを別のデータセンターにデプロイすることで、ワークロードをフェールオーバーし、予期しないダウンタイムを最小限に抑えることができます。 Azure Stack Hub が 1 つしかない場合は、Azure パブリック クラウドを復旧クラウドとして使用することを検討してください。 アプリケーションをどこで実行できるかは、政府の規制、企業のポリシー、および厳格な待機時間の要件によって決まります。 アプリケーションごとに適切な回復場所を柔軟に決定することができます。 たとえば、あるサブスクリプションのアプリケーションが別のデータセンターにデータをバックアップし、別のサブスクリプションのアプリケーションが Azure パブリック クラウドにデータをレプリケートするように設定できます。

## <a name="application-recovery-objectives"></a>アプリケーションの回復目標

アプリケーション所有者は、アプリケーションと組織で許容できるダウンタイムとデータ損失の量を判断することに主に責任があります。 許容できるダウンタイムと許容できるデータ損失を定量化することで、災害による組織への影響を最小限に抑える回復計画を作成できます。 各アプリケーションについて、次の点を考慮してください。

 - **目標復旧時間 (RTO)**  
RTO は、インシデントの発生後に、アプリを使用不可状態にすることができる最大許容時間です。 たとえば、RTO が 90 分の場合、災害発生から 90 分以内にアプリを実行状態に復元できなければならないことを意味します。 RTO を短くする場合は、リージョンの障害から保護するために、2 つ目のデプロイをスタンバイ状態で継続的に実行します。
 - **目標復旧時点 (RPO)**  
RPO は、障害発生時に許容できるデータ損失の最大期間です。 たとえば、1 時間ごとにバックアップされる単一データベースにデータを格納していて、他のデータベースへのレプリケーションがない場合、最大 1 時間のデータを失う可能性があります。

もう 1 つのメトリックは、*平均復旧時間* (MTTR) です。MTTR は、障害発生後にアプリケーションの復元にかかる平均時間です。 MTTR はシステムの経験値です。 MTTR が RTO を超えると、定義されている RTO 以内にシステムを復元できなくなるため、システムに障害が発生すると許容できないビジネスの中断が発生します。

## <a name="protection-options"></a>保護オプション 

### <a name="backup-restore"></a>バックアップと復元

アプリケーションとデータセットをバックアップすることで、データの破損、偶発的な削除、災害などによるダウンタイムから迅速に復旧できます。 IaaS VM ベースのアプリケーションでは、ゲスト内エージェントを使用して、アプリケーション データ、オペレーティング システムの構成、およびボリュームに格納されているデータを保護できます。 

#### <a name="backup-using-in-guest-agent"></a>ゲスト内エージェントを使用したバックアップ

ゲスト OS エージェントを使用した VM のバックアップには、通常、オペレーティング システムの構成、ファイル/フォルダー、ディスク、アプリケーション バイナリ、またはアプリケーション データのキャプチャが含まれます。 

エージェントからアプリケーションを復旧するには、手動で VM を再作成し、オペレーティング システムをインストールして、ゲスト エージェントをインストールする必要があります。 その時点で、データをゲスト OS に復元することも、アプリケーションに直接復元することもできます。

#### <a name="backup-using-disk-snapshot-for-stopped-vms"></a>停止した VM のディスク スナップショットを使用したバックアップ

バックアップ製品では、停止した VM に接続されている IaaS VM の構成とディスクを保護できます。 Azure Stack Hub API と統合されたバックアップ製品を使用して、VM 構成をキャプチャし、ディスク スナップショットを作成します。 アプリケーションの計画的ダウンタイムが可能な場合は、バックアップ ワークフローを開始する前に、VM が停止状態になっていることを確認してください。  

#### <a name="backup-using-disk-snapshot-snapshot-for-running-vms"></a>実行中の VM のディスク スナップショットを使用したバックアップ

> [!Important]  
> ディスク スナップショットの使用は、実行状態の VM では現在サポートされていません。 実行中の VM に接続されているディスクのスナップショットを作成すると、パフォーマンスが低下したり、VM 内のオペレーティング システムやアプリケーションの可用性に影響したりすることがあります。 計画的ダウンタイムが不可能な場合は、ゲスト内エージェントを使用してアプリケーションを保護することをお勧めします。 

### <a name="vms-in-a-scale-set-or-availability-set"></a>スケールセットまたは可用性セット内の VM

一時的なリソースと見なされるスケールセットまたは可用性グループ内の VM は、特にアプリケーションがステートレスである場合は、VM レベルでバックアップしないでください。 スケールセットまたは可用性セットにデプロイされたステートフル アプリケーションの場合は、アプリケーション データ (たとえば、記憶域プール内のデータベースまたはボリューム) を保護することを検討してください。 

### <a name="replicationmanual-failover"></a>レプリケーション/手動フェールオーバー

データ損失またはダウンタイムを最小限にすることが必要なアプリケーションでは、データ レプリケーションをゲスト OS またはアプリケーション レベルで有効にして、データを別の場所にレプリケートすることができます。 Microsoft SQL Server などの一部のアプリケーションでは、レプリケーションがネイティブにサポートされています。 アプリケーションでレプリケーションがサポートされていない場合は、ゲスト OS のソフトウェアを使用してディスクをレプリケートするか、ゲスト OS にエージェントとしてインストールされるパートナー ソリューションを使用することができます。

この方法を使用すると、アプリケーションはあるクラウドにデプロイされ、データはオンプレミスの別のクラウドまたは Azure にレプリケートされます。 フェールオーバーがトリガーされた場合は、ターゲット内のアプリケーションを起動し、レプリケートされたデータにアタッチしてから、要求の処理を開始する必要があります。
 
### <a name="high-availabilityautomatic-failover"></a>高可用性/自動フェールオーバー

許容できるダウンタイムが数秒または数分のみであるステートレス アプリケーションの場合、高可用性構成を検討してください。 高可用性アプリケーションは、すべてのインスタンスが要求を処理できるアクティブ/アクティブ トポロジ内の複数の場所にデプロイされるように設計されています。 ローカル ハードウェア障害に備えて、Azure Stack Hub インフラストラクチャでは、2 つのトップ オブ ラック スイッチを使用して物理ネットワークで高可用性が実装されます。 コンピューティング レベルの障害に備えて、Azure Stack Hub ではスケール ユニット内の複数のノードが使用されており、VM は自動でフェールオーバーされます。 VM レベルでは、ノードの障害によってアプリケーションが停止しないように、可用性セットのスケール セットまたは VM をご利用いただけます。 同じアプリケーションを、同じ構成のセカンダリの場所にデプロイする必要があります。 アプリケーションをアクティブ/アクティブにするには、ロード バランサーまたは DNS を使用して、使用可能なすべてのインスタンスに要求を送信します。

### <a name="no-recovery"></a>復旧不要

環境内の一部のアプリは、計画外のダウンタイムやデータ損失から保護する必要がない場合があります。 たとえば、開発やテストに使用される VM は、通常、復旧する必要はありません。 アプリケーションまたはデータセットの保護なしで済ませるかどうかは自由に決めることができます。

## <a name="recommended-topologies"></a>推奨されるトポロジ

Azure Stack Hub のデプロイに関する重要な考慮事項を次に示します。

|     | 推奨 | 説明 |
|-------------------------------------------------------------------------------------------------|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|**データ センターに既にデプロイされている外部バックアップ ターゲットに VM をバックアップ/復元する**| 推奨 | 既存のバックアップ インフラストラクチャと運用スキルを活用します。 追加の VM インスタンスをすぐに保護できるように、バックアップ インフラストラクチャのサイズを必ず設定します。 バックアップ インフラストラクチャが、ソースに近接する場所にないことを確認します。 VM は、ソース Azure Stack Hub、セカンダリ Azure Stack Hub インスタンス、または Azure に復元できます。 |
|**Azure Stack Hub 専用の外部バックアップ ターゲットに VM をバックアップおよび復元する**| 推奨 | 新しいバックアップ インフラストラクチャを購入することも、Azure Stack Hub 専用のバックアップ インフラストラクチャをプロビジョニングすることもできます。 バックアップ インフラストラクチャが、ソースに近接する場所にないことを確認します。 VM は、ソース Azure Stack Hub、セカンダリ Azure Stack Hub インスタンス、または Azure に復元できます。 |
|**グローバル Azure または信頼できるサービス プロバイダーに VM を直接バックアップ/復元する**| 推奨 | データのプライバシーと規制の要件を満たすことができるのであれば、グローバル Azure または信頼できるサービス プロバイダーにバックアップを保存できます。 復元時の運用エクスペリエンスの一貫性を得るために、サービス プロバイダーも Azure Stack Hub を実行しているのが理想的です。 |
|**別の Azure Stack Hub インスタンスに VM をレプリケートまたはフェールオーバーする**| 推奨 | フェールオーバーの場合、アプリの長時間のダウンタイムを回避できるように、2 つ目の Azure Stack Hub クラウドを完全に稼働させる必要があります。 |
|**Azure または信頼できるサービス プロバイダーに VM を直接レプリケート/フェールオーバーする**| 推奨 | データのプライバシーと規制の要件を満たすことができるのであれば、グローバル Azure または信頼できるサービス プロバイダーにデータをレプリケートできます。 フェールオーバー後の運用エクスペリエンスの一貫性を得るために、サービス プロバイダーも Azure Stack Hub を実行しているのが理想的です。 |
|**同一のバックアップ ターゲットによって保護されているすべてのアプリケーションをホストする同じ Azure Stack Hub 上にバックアップ ターゲットを配置します。**| スタンドアロン ターゲット:推奨されません </br> バックアップ データを外部でレプリケートするターゲット:推奨 | (操作の復元の最適化のために) Azure Stack Hub にバックアップ アプライアンスをデプロイする場合は、すべてのデータが外部のバックアップの場所に継続的にコピーされるようにする必要があります。 |
|**Azure Stack Hub ソリューションがインストールされている同じラックに物理バックアップ アプライアンスを配置する**| サポートされていません | 現時点では、元のソリューションに含まれていない他のデバイスを、トップ オブ ラック スイッチに接続することはできません。 |

## <a name="next-steps"></a>次のステップ

この記事では、Azure Stack Hub にデプロイされたユーザー VM を保護するための一般的なガイドラインについて説明しました。 Azure サービスを使用したユーザー VM の保護については、以下を参照してください。

- [Azure Stack IaaS – パート 4 – 保護を行う](https://azure.microsoft.com/blog/azure-stack-iaas-part-four/)
- [事業継続とディザスター リカバリーへの配慮](https://aka.ms/azurestackbcdrconsiderationswp)

### <a name="azure-backup-server"></a>Azure Backup Server
 - [Azure Backup を使用してファイルやアプリを Azure Stack Hub にバックアップする](/azure/backup/backup-mabs-files-applications-azure-stack)
 - [Azure Backup Server による Azure Stack Hub のサポート](/azure/backup/ ) 
 
 ### <a name="azure-site-recovery"></a>Azure Site Recovery
 - [Azure Site Recovery による Azure Stack Hub のサポート](/azure/site-recovery/)  
 
 ### <a name="partner-products"></a>パートナー製品
 - [Azure Stack Hub データセンター統合のパートナー エコシステムのデータシート](https://aka.ms/azurestackbcdrpartners)
