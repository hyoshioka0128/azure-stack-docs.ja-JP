---
title: Azure Stack Hub のストレージ インフラストラクチャの概要
titleSuffix: Azure Stack
description: Azure Stack Hub 用のストレージ インフラストラクチャを管理する方法について説明します。
author: PatAltimore
ms.topic: conceptual
ms.date: 05/11/2020
ms.author: patricka
ms.lastreviewed: 5/5/2020
ms.reviewer: jiaha
ms.custom: contperf-fy20q4
ms.openlocfilehash: 04a4e2314fb91a2a8a8eaedf0ca5d5849c8bee10
ms.sourcegitcommit: 733a22985570df1ad466a73cd26397e7aa726719
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/05/2021
ms.locfileid: "97869170"
---
# <a name="azure-stack-hub-storage-infrastructure-overview"></a>Azure Stack Hub のストレージ インフラストラクチャの概要

この記事では、Azure Stack Hub のストレージ インフラストラクチャの概念について説明します。 ドライブとボリュームに関する情報、および Azure Stack Hub での使用方法について説明します。

## <a name="drives"></a>ドライブ

### <a name="drive-types"></a>ドライブの種類

Azure Stack Hub の統合システム パートナーからは、ストレージの幅広い柔軟性など、バリエーション豊かなソリューションが提供されています。 現在、サポートされている次の 3 つのドライブの種類から **2 つ** までを選択できます。

1. NVMe (Non-Volatile Memory Express)
1. SATA/SAS SSD (ソリッドステート ドライブ)
1. HDD (ハード ディスク ドライブ)

### <a name="performance-vs-capacity"></a>パフォーマンスと容量

Azure Stack Hub では、記憶域スペース ダイレクト (Storage Spaces Direct: S2D) と Windows Server フェールオーバー クラスタリングが使用されます。 この組み合わせにより、パフォーマンス、スケーラビリティ、回復性の優れたストレージ サービスが提供されます。

Azure Stack のデプロイでは、ストレージのパフォーマンスを最大化したり、パフォーマンスと容量のバランスを取ったりすることができます。

記憶域スペース ダイレクトでは、キャッシュを使ってストレージのパフォーマンスが最大化されます。

### <a name="how-drive-types-are-used"></a>ドライブの種類の使用方法

1 種類のドライブを備えた Azure Stack Hub アプライアンスでは、すべてのドライブが容量に使用されます。

2 種類のドライブがある場合は、記憶域スペース ダイレクトにより "最も高速な" 種類のドライブ (NVMe &gt; SSD &gt; HDD) がすべて、自動的にキャッシュとして使用されます。 残りのドライブは、キャパシティとして使用されます。

### <a name="all-flash-or-hybrid"></a>オールフラッシュまたはハイブリッド

ドライブは "オールフラッシュ" と "ハイブリッド" のいずれかのデプロイにグループ化することができます。

オールフラッシュ型のデプロイは、ストレージのパフォーマンスを最大化することを目標としたものであり、回転式のハード HDD が含まれません。

![オールフラッシュ型のデプロイのグループ化を示す図。](media/azure-stack-storage-infrastructure-overview/image1.png)


ハイブリッド型のデプロイは、パフォーマンスとキャパシティのバランスの調和またはキャパシティの最大化を目標としたもので、回転式の HDD が含まれます。

![ハイブリッド型のデプロイのグループ化を示す図。](media/azure-stack-storage-infrastructure-overview/image2.png)

### <a name="caching-behavior"></a>キャッシュ動作

キャッシュの動作は、ドライブの種類に応じて自動的に決まります。 キャッシュの対象が SSD の場合 (SSD のキャッシュを NVMe に保存する場合など) には、書き込みのみがキャッシュに保存されます。 こうすることによって、キャパシティ ドライブに流入するトラフィックの累積量を減らし、キャパシティ ドライブの劣化スピードを遅らせ、ドライブの寿命を延ばしています。

読み取りはキャッシュされません。 キャッシュに保存されないのは、読み取りがフラッシュの寿命に及ぼす影響はわずかであり、SSD の読み取り遅延は常に低いためです。

キャッシュの対象が HDD の場合 (HDD のキャッシュを SSD に保存する場合など) には、読み取りと書き込みのどちらにもフラッシュと同等の待ち時間 (多くの場合、約 10 倍のスピード) を実現できるよう、読み取りと書き込みの両方がキャッシュに保存されます。

![Azure Stack Hub のストレージのキャッシュ動作を示す図。](media/azure-stack-storage-infrastructure-overview/image3.svg)

利用できるストレージ構成については、Azure Stack Hub OEM パートナー (https://azure.microsoft.com/overview/azure-stack/partners/) にお問い合わせのうえ、仕様の詳細をご確認ください。

> [!NOTE]
> Azure Stack Hub アプライアンスは、HDD ドライブと SSD (または NVMe) ドライブの両方を備えたハイブリッド デプロイとしてお届けすることができます。 ただし、高速な方のドライブはキャッシュ ドライブ、残りのドライブはすべてキャパシティ ドライブ プールとして、それぞれ使用されます。 テナント データ (BLOB、テーブル、キュー、ディスク) は、キャパシティ ドライブに保存されます。 Premium ディスクをプロビジョニングしたり、Premium ストレージ アカウントの種類を選択しても、オブジェクトが SSD ドライブまたは NVMe ドライブに割り当てられる保証はありません。

## <a name="volumes"></a>ボリューム

"*ストレージ サービス*" では、利用可能なストレージが複数のボリュームにパーティション分割されます。分割によってできた個別のボリュームは、システム データとテナント データを保持するために割り当てられます。 記憶域プール内のドライブを組み合わせたボリュームでは、記憶域スペース ダイレクトのフォールト トレランス、スケーラビリティ、パフォーマンス面のメリットが提供されます。

![Azure Stack Hub のストレージ サービスのパーティションを示す図。](media/azure-stack-storage-infrastructure-overview/image4.svg)

### <a name="volume-types"></a>ボリュームの種類

Azure Stack Hub の記憶域プール上に作成されるボリュームは 3 種類あります。

1. **インフラストラクチャ** ボリュームでは、Azure Stack Hub インフラストラクチャ VM とコア サービスによって使用されるファイルがホストされます。
1. **VM 一時ボリューム** では、テナント VM に接続されている一時ディスクと、そのディスクに格納されているデータがホストされます。
1. **オブジェクト ストア** ボリュームでは、BLOB、テーブル、キュー、および VM ディスクにサービスを提供するテナント データがホストされます。

### <a name="volumes-in-a-multi-node-deployment"></a>マルチノード デプロイでのボリューム

マルチノード デプロイには、3 つのインフラストラクチャ ボリュームがあります。

VM 一時ボリュームとオブジェクト ストア ボリュームの数は、Azure Stack Hub のデプロイに含まれるノード数と同じになります。

- 4 ノードのデプロイでは、VM 一時ボリューム、オブジェクト ストア ボリュームとも、同一のものがそれぞれ 4 つずつあります。

- クラスターに新しいノードを 1 つ追加すると、両方の種類のボリュームが 1 つずつ新たに作成されます。

- ボリュームの数は、ノードに不具合が発生したり、ノードを削除したりした場合でもそのまま維持されます。

> [!NOTE]
> [Azure Stack Development Kit (ASDK)](../asdk/index.yml) を使用する場合は、複数の[共有](azure-stack-manage-storage-shares.md)を含む単一のボリュームがあります。

### <a name="fault-tolerance-and-mirroring"></a>フォールト トレランスとミラーリング

記憶域スペース ダイレクト内のボリュームでは、ドライブやサーバーの障害などのハードウェアの問題から保護するための回復性が提供されます。 ソフトウェアの更新などのサーバーのメンテナンスを通して、継続的な可用性が実現されます。

ミラーリングを使ってあらゆるデータのコピーを複数保持することによって、フォールト トレランスが実現します。 データをどのようにストライピングして配置するかは重要な問題ですが、ミラーリングを使って格納されるデータは、いずれもそのままの形で複数回書き込まれます。 コピーはそれぞれ、障害の発生が個別にとどまることが想定される別々の物理ハードウェア (別のサーバーの別のドライブ) に書き込まれます。 

Azure Stack Hub のデプロイでは、データの回復性確保のために 3 方向のミラーリングが使用されます。 3 方向ミラーリングでは、一度に 2 台以上のハードウェア (ドライブまたはサーバー) に問題が発生した場合でも、安全に耐えることができます。 たとえば、あるサーバーの再起動中に別のドライブまたはサーバーに突然障害が発生した場合でも、あらゆるデータが安全かつアクセス可能な状態に保たれます。

テナント データのコピーが 3 つ、別々のサーバーに書き込まれ、キャッシュに保存されます。

![テナント データの 3 つのコピーがどのように異なるサーバーに書き込まれるかを示す図。](media/azure-stack-storage-infrastructure-overview/image5.png)

## <a name="next-step"></a>次のステップ

[ストレージ容量の管理](azure-stack-manage-storage-shares.md) 
