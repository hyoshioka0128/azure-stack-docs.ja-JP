---
title: Azure Stack Hub でのオファーの委任
description: オファーの作成やユーザーのサインアップなどのタスクを委任する方法について説明します。
author: sethmanheim
ms.topic: article
ms.date: 12/15/2020
ms.author: sethm
ms.reviewer: alfredop
ms.lastreviewed: 05/07/2019
ms.openlocfilehash: 806c4c565553fe76cb8347d763aa7ce20e000821
ms.sourcegitcommit: a53ea4a28e715c80a99fa89e9d364bc4556558de
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/16/2020
ms.locfileid: "97577076"
---
# <a name="delegate-offers-in-azure-stack-hub"></a>Azure Stack Hub でのオファーの委任

Azure Stack Hub オペレーターが、ユーザーのサインアップとサブスクリプション作成を他のユーザーに担当してもらいたいとします。 たとえば、あなたがサービス プロバイダーで、再販業者に顧客のサインアップと管理を担当してもらいたい場合があります。 また、社内の中央の IT 部門に所属している場合は、ユーザーのサインアップを他の IT 部門のスタッフに委任する場合もあります。

次の図に示すように、委任することで、自分で行う場合より簡単に、多くのユーザーに連絡したり、ユーザーを管理したりできます。

![Azure Stack Hub での委任のレベル](media/azure-stack-delegated-provider/image1.png)

委任を使用すると、委任されたプロバイダーがオファーを管理する (*委任されたオファー* と呼ばれる) ため、エンド カスタマーはシステム管理者からの関与なしに、そのオファーのサブスクリプションを取得します。

## <a name="delegation-roles"></a>委任ロール

次のロールは委任の一部です。

* *Azure Stack Hub のオペレーター* は、Azure Stack Hub インフラストラクチャを管理し、オファー テンプレートを作成します。 オペレーターは、テナントにオファーを提供する業務を委任します。

* 委任された Azure Stack Hub オペレーターとは、*委任されたプロバイダー* と呼ばれるサブスクリプションで、*所有者* または *共同作成者* の権限を持つユーザーです。 他の組織 (他の Azure Active Directory (Azure AD) テナントなど) に属すことができます。

* *ユーザー* はオファーにサインアップして、それらを使用してワークロードの管理、VM の作成、データの格納などを行います。

## <a name="delegation-steps"></a>委任手順

委任を設定する手順は 2 つあります。

1. **委任されたプロバイダー サブスクリプションを作成する**: ユーザーをこのサブスクリプション サービスのみが含まれたオファーにサブスクライブします。 このオファーをサブスクライブするユーザーは、委任されたオファーにサインアップすると、それらのオファーを他のユーザーに拡張できます。

2. **委任されたプロバイダーにオファーを委任する**: このオファーにより、委任されたプロバイダーはサブスクリプションを作成すること、またはユーザーにオファーを拡張することができます。 委任されたプロバイダーはこのオファーを受け取り、他のユーザーに拡張できるようになります。

次の図は、委任を設定するための手順を示しています。

![Azure Stack Hub で委任されたプロバイダーを作成し、ユーザーをサインアップできるようにする手順](media/azure-stack-delegated-provider/image2.png)

### <a name="delegated-provider-requirements"></a>委任されたプロバイダーの要件

委任されたプロバイダーとして機能するために、ユーザーは、サブスクリプションを作成することによってメイン プロバイダーとの関係を確立します。 このサブスクリプションは、メイン プロバイダーの代わりに委任されたオファーを提供する権限を持つものとして委任されたプロバイダーを識別します。

この関係が確立されると、Azure Stack Hub オペレーターは委任されたプロバイダーにオファーを委任できます。 委任されたプロバイダーはこれで、オファーを取得し、その名前を変更し (その内容は変更できません)、お客様に提供できるようになります。

## <a name="delegation-walkthrough"></a>委任のチュートリアル

以降のセクションでは、委任されたプロバイダーの設定、オファーの委任、委任されたオファーにユーザーがサインアップできるかどうかの確認を行う手順について説明します。

### <a name="set-up-roles"></a>ロールの設定

このチュートリアルを実行するには、お使いの Azure Stack Hub オペレーター アカウントに加え Azure AD アカウントが 2 つ必要です。 これらの 2 つのアカウントがない場合は、それらを作成する必要があります。 アカウントは、任意の Azure AD ユーザーに属することができ、"*委任されたプロバイダー*" および "*ユーザー*" と呼ばれます。

| **ロール** | **組織の権限** |
| --- | --- |
| 委任されたプロバイダー |User |
| User |User |

 > [!NOTE]
 > CSP リセラーの場合、この委任されたプロバイダーを作成するには、これらのユーザーがテナント ディレクトリ (ユーザーの Azure AD) 内に存在する必要があります。 Azure Stack Hub オペレーターは、そのテナント Azure AD を[まずオンボード](azure-stack-enable-multitenancy.md)してから、[こちらの手順](azure-stack-csp-howto-register-tenants.md)に従って使用量と課金を設定する必要があります。

### <a name="identify-the-delegated-provider"></a>委任されたプロバイダーを識別します。

1. 管理者ポータルに Azure Stack Hub オペレーターとしてサインインします。

1. ユーザーが委任されたプロバイダーになることができるオファーを作成するには:

   a.  [プランを作成します](azure-stack-create-plan.md)。
       このプランには、サブスクリプション サービスのみを含める必要があります。 この記事では、**PlanForDelegation** という名前のプランを例として使用します。

   b.  このプランに基づいて、[オファーを作成](azure-stack-create-offer.md)します。 この記事では、**OfferToDP** という名前のオファーを例として使用します。

   c.  **[サブスクリプション]** 、 **[追加]** 、 **[新しいテナント サブスクリプション]** の順に選択することによって、委任されたプロバイダーをこのオファーへのサブスクライバーとして追加します。

   ![Azure Stack Hub 管理者ポータルで委任されたプロバイダーをサブスクライバーとして追加する](media/azure-stack-delegated-provider/image3.png)

   > [!NOTE]
   > すべての Azure Stack Hub オファーと同様に、オファーをパブリックにしてユーザーにサインアップさせるオプションと、それをプライベートのままにして Azure Stack Hub オペレーターにサインアップを管理させるオプションがあります。 委任されたプロバイダーは通常、小規模なグループです。 参加しているユーザーを管理したいため、たいていの場合このオファーはプライベートにしておくのが適切です。

### <a name="azure-stack-hub-operator-creates-the-delegated-offer"></a>Azure Stack Hub のオペレーターが委任されたオファーを作成する

次の手順は、委任することになる、そしてユーザーが使用することになる、プランとオファーの作成です。 委任されたプロバイダーはそこに含まれるプランとクォータを変更できないため、このオファーは、ユーザーに表示させたいとおりに定義することをお勧めします。

1. Azure Stack Hub のオペレーターとして[プランを作成し](azure-stack-create-plan.md)、そのプランに基づいた[オファー](azure-stack-create-offer.md)を作成する必要があります。 この記事では、**DelegatedOffer** という名前のオファーを例として使用します。

   > [!NOTE]
   > このオファーをパブリックにする必要はありませんが、パブリックにすることもできます。 ただし、委任されたプロバイーダのみにオファーのアクセス権を付与したい場合がほとんどです。 次の手順にあるようにプライベート オファーを委任すると、以降は委任されたプロバイダーがアクセス権を持ちます。

2. オファーを委任します。 **DelegatedOffer** に移動します。 **[設定]** で、 **[委任されたプロバイダー]** 、 **[追加]** の順に選択します。

3. ドロップダウン リストから、委任されたプロバイダーのサブスクリプションを選択してから、 **[委任]** を選択します。

   ![Azure Stack Hub 管理者ポータルで委任されたプロバイダーを追加する](media/azure-stack-delegated-provider/image4.png)

### <a name="delegated-provider-customizes-the-offer"></a>委任されたプロバイダーがオファーをカスタマイズする

委任されたプロバイダーとしてユーザー ポータルにサインインし、委任されたオファーをテンプレートとして使用して、新しいオファーを作成します。

1. **[+ リソースの作成]** 、 **[テナントのプラン]** 、 **[オファー]** の順に選択します。

    ![Azure Stack Hub ユーザー ポータルで新しいオファーを作成する](media/azure-stack-delegated-provider/image5.png)

2. オファーに名前を割り当てます。 この例では、**ResellerOffer** を使用します。 基になる委任されたオファーを選択して、 **[作成]** を選択します。

   ![Azure Stack Hub ユーザー ポータルで名前を割り当てる](media/azure-stack-delegated-provider/image6.png)

   >[!IMPORTANT]
   >委任されたプロバイダーは自分に委任されたオファーしか選択できない点を理解することが重要です。 これらのオファーに変更を加えることはできません。これらのオファーを変更できるのは、Azure Stack Hub オペレーターだけです。 たとえば、オペレーターのみがプランとクォータを変更できます。 委任されたプロバイダーが基本プランやアドオン プランからオファーを構築することはありません。

3. 委任されたプロバイダーは、独自のポータル URL からこれらのオファーを公開できます。 オファーを公開するには、 **[参照]** 、 **[オファー]** の順に選択します。 オファーを選び、 **[状態の変更]** を選択します。

4. これら公開用の委任されたオファーは、委任されたポータルを介してのみ表示できるようになりました。 この URL を検索し変更するには、以下を行います。

    a.  **[参照]** 、 **[すべてのサービス]** の順に選択し、 **[全般]** カテゴリで **[サブスクリプション]** を選択します。 委任されたプロバイダー サブスクリプション (**DPSubscription** など)、 **[プロパティ]** の順に選択します。

    b.  ポータル URL を、メモ帳など別の場所にコピーします。

    ![Azure Stack Hub ユーザー ポータルで委任されたプロバイダーのサブスクリプションを選択する](media/azure-stack-delegated-provider/dpportaluri.png)  

   委任されたプロバイダーとして委任されたオファーの作成を完了しました。 委任されたプロバイダーとしてサインアウトし、ブラウザー ウィンドウを閉じます。

### <a name="sign-up-for-the-offer"></a>オファーのサインアップ

1. 新しいブラウザー ウィンドウで、前の手順で保存した、委任されたポータル URL に移動します。 ユーザーとしてポータルにサインインします。

   >[!NOTE]
   >委任されたポータルを使用しない限り、委任されたオファーは表示されません。

1. ダッシュボードで、 **[Get a subscription]\(サブスクリプションを取得\)** を選択します。 委任されたプロバイダーによって作成された、委任されたオファーのみがユーザーに表示されることがわかります。

   ![Azure Stack Hub ユーザー ポータルでオファーを表示して選択する](media/azure-stack-delegated-provider/image8.png)

オファーを委任するプロセスは完了しました。 これで、ユーザーはそのサブスクリプションを取得することによって、このオファーにサインアップできます。

## <a name="move-subscriptions-between-delegated-providers"></a>委任されたプロバイダー間でのサブスクリプションの移動

必要に応じて、同じディレクトリ テナントに属する新規または既存の委任されたプロバイダー サブスクリプションの間でサブスクリプションを移動できます。 移動するには、PowerShell コマンドレットの [Move-AzsSubscription](/powershell/module/azs.subscriptions.admin) を使用できます。

サブスクリプションの移動は、次の場合に役立ちます。

* 委任されたプロバイダー ロールを引き受ける新しいチーム メンバーを追加し、このチーム メンバーに、既定のプロバイダー サブスクリプションで前に作成したユーザー サブスクリプションを割り当てる場合。
* 同じディレクトリ テナント (Azure AD) 内に複数の委任されたプロバイダー サブスクリプションがあり、それらの間でユーザー サブスクリプションを移動する必要がある場合。 このシナリオは、チーム メンバーがチーム間を移動し、そのサブスクリプションを新しいチームに割り当てる必要がある場合に発生する可能性があります。

## <a name="next-steps"></a>次のステップ

* [VM のプロビジョニング](../user/azure-stack-create-vm-template.md)
