---
title: Azure Stack Hub ラグドのネットワーク構成ライフサイクル管理
description: Azure Stack Hub ラグド デバイスのネットワーク構成ライフサイクル管理について説明します。
author: BryanLa
ms.author: bryanla
ms.service: azure-stack
ms.topic: conceptual
ms.date: 10/14/2020
ms.lastreviewed: 10/14/2020
ms.openlocfilehash: 7fecbd264c5165cf05f494d9a24cb9462f8527ca
ms.sourcegitcommit: 50b362d531c2d35a3a935811fee71252971bd5d8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "96941419"
---
# <a name="azure-stack-hub-ruggedized-network-configuration-lifecycle-management"></a>Azure Stack Hub ラグドのネットワーク構成ライフサイクル管理

このトピックでは、ネットワーク構成のライフサイクル管理について説明します。

## <a name="update-configuration"></a>構成を更新する


フィールドのスイッチ構成を更新する方法。 これは、すべての種類の構成の更新に適用されます。 お客様または OEM によって適用された手動の構成など、多くの不明な変数がコントロールの外部にあるため、これは複数の手順から成る手動プロセスになります。 現時点では、アップタイムの保証はなく、メンテナンス期間中に更新を実行する必要があります。

**\#1 -** tor1、tor2、および BMC スイッチの現在の構成ファイルのバックアップを作成します。 これらのファイルをスイッチからコピーします。

**\#2 -** 既存の構成のツールキットのビルド番号をメモします。
すべての構成で、これを **motd** バナーに含める必要があります。 *"BUILDNUMBER"* を検索します

**\#3 -** 手順 \#2 と同じツールキット バージョンを使用して、初期構成を再生成します。

**\#4 -** 手順 \#3 の構成をそれぞれのスイッチに読み込みます。
このポイントは、ベースラインを取得するために、スイッチを介してツールによって生成された構成を "*洗う*" ことです。 これは、OEM のラボのように、OEM によって別のハードウェア上で実行される場合や、お客様と共にオンサイトで実行される場合があります。

**\#5 -** 手順 \#4 の構成ファイルのバックアップを作成し、リモートの場所にコピーします

**\#6 -** 選択した diff ツールを使用して、手順 \#1 の現在の構成のバックアップと手順 \#5 のベースライン構成のバックアップを比較します。 デバイスごとに、アップグレードされたスイッチ構成に引き継ぐ必要があるすべての相違点をメモまたはコピーします。

**\#7 -** 更新されたスイッチ構成を生成する新しいツールキットを実行します。

**\#8 -** 手順 6 の相違点を新しいスイッチ構成にマージします。

**\#9 -** 新しい構成をそれぞれのスイッチに読み込み、ツールの出力ディレクトリで、用意されている検証後のコマンドを実行します。

**\#10 -** 構成を保存します。

## <a name="ntp"></a>NTP

Azure Stack でのタイム サーバーを更新するには、特権エンドポイント (PEP) を使用できます。 2 つ以上の NTP サーバーの IP アドレスに解決されるホスト名を使用します。

Azure Stack では、ネットワーク タイム プロトコル (NTP) を使用して、インターネット上のタイム サーバーに接続します。 NTP サーバーからは、正確なシステム時刻が提供されます。 時刻は、Azure Stack の物理ネットワーク スイッチ、ハードウェア ライフサイクル ホスト、インフラストラクチャ サービス、および仮想マシン間で使用されます。 クロックが同期されていない場合、Azure Stack では、ネットワークと認証に関する重大な問題が発生する可能性があります。 ログ ファイル、ドキュメント、およびその他のファイルが、不正確なタイムスタンプによって作成される可能性があります。

Azure Stack で時刻を同期するには、タイム サーバー (NTP) を 1 つ指定する必要があります。
Azure Stack をデプロイするときに、NTP サーバーのアドレスを指定します。 時刻は、重要なデータセンター インフラストラクチャ サービスです。 サービスが変更された場合は、時刻を更新する必要があります。

Azure Stack では、時刻を同期できるタイム サーバー (NTP) は 1 つだけです。 Azure Stack で時刻を同期する NTP を複数指定することはできません。 複数の NTP サーバーに解決される DNS エントリを設定することをお勧めします。 

### <a name="update-ntp-post-deployment"></a>デプロイ後の NTP を更新する

1.  特権エンドポイント (PEP) に接続します。 特権エンドポイントのロックを解除するためにサポート チケットを開く必要はありません。 |

2.  次のコマンドを実行して、現在構成されている NTP サーバーを確認します。

    ```powershell
    Get-AzsTimeSource
    ```

3.  次のコマンドを実行して、新しい NTP サーバーを使用するように Azure Stack を更新し、時刻を直ちに同期します。

    ```powershell
    Set-AzsTimeSource -Timeserver NEWTIMESERVER -resync
    ```

    >[!NOTE] 
    > この手順では、物理スイッチ上のタイム サーバーは更新されません。 

## <a name="dns"></a>DNS

### <a name="update-the-dns-forwarder-in-azure-stack"></a>Azure Stack の DNS フォワーダーを更新する

Azure Stack インフラストラクチャで外部名を解決するには、少なくとも 1 つの到達可能な DNS フォワーダーが必要です。 Azure Stack のデプロイには、DNS フォワーダーを用意する必要があります。 その入力が Azure Stack の内部 DNS サーバーでフォワーダーとして使用され、認証、Marketplace 管理、使用などのサービスの外部名の解決が可能になります。

DNS は、変更可能な重要なデータセンター インフラストラクチャ サービスであり、変更した場合は Azure Stack を更新する必要があります。

この記事では、特権エンドポイント (PEP) を使用して Azure Stack の DNS フォワーダーを更新する方法について説明します。 2 つの信頼できる DNS フォワーダー IP アドレスを使用することをお勧めします。

1.  特権エンドポイント (PEP) に接続します。 特権エンドポイントのロックを解除するためにサポート チケットを開く必要はありません。 

2.  次のコマンドを実行して、現在構成されている DNS フォワーダーを確認します。 別の方法として、管理ポータルのリージョンのプロパティを使用することもできます。

    ```powershell
    Get-AzsDnsForwarder
    ```

3.  次のコマンドを実行して、新しい DNS フォワーダーを使用するように Azure Stack を更新します。

    ```powershell
    Set-AzsDnsForwarder -IPAddress "IPAddress 1", "IPAddress 2" 
    ```

4.  エラーが発生した場合は、コマンドの出力を確認してください。