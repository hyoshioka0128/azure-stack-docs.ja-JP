---
title: Azure Stack にデプロイされた VM の保護 | Microsoft Docs
description: データ損失や計画外のダウンタイムから Azure Stack にデプロイされた VM を保護するための復旧計画の作成方法について説明します。
services: azure-stack
documentationcenter: ''
author: sethmanheim
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: tzl
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 10/02/2019
ms.author: sethm
ms.reviewer: hectorl
ms.lastreviewed: 3/19/2018
ms.openlocfilehash: c57e421140dfea9eac949b5dcf97cc90745ab861
ms.sourcegitcommit: d719f148005e904fa426a001a687e80730c91fda
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/06/2021
ms.locfileid: "97910961"
---
# <a name="protect-vms-deployed-on-azure-stack-hub---ruggedized"></a>Azure Stack Hub にデプロイされた VM の保護 - ラグド

この記事は、ユーザーが Azure Stack Hub にデプロイする仮想マシン (VM) の保護計画を作成するためのガイドとして使用してください。

データの損失や計画外のダウンタイムから保護するには、Azure Stack Hub 上の VM ベースのアプリケーションにデータ保護とディザスター リカバリーの計画を実装する必要があります。 実装する保護計画は、ビジネス要件やアプリケーションの設計によって異なります。 この計画は、組織の包括的な事業継続とディザスター リカバリー (BC/DR) 戦略によって確立されたフレームワークに従っている必要があります。 Azure Stack Hub の BC/DR で考慮すべき事柄の概略については、「Azure Stack: 事業継続とディザスター リカバリーに関する考慮事項」を参照してください。

## <a name="application-recovery-objectives"></a>アプリケーションの回復目標

組織がアプリケーションごとに許容できるダウンタイムとデータ損失の量を決定します。 ダウンタイムとデータ損失を定量化することで、障害による組織への影響を最小限に抑える回復計画を作成できます。 各アプリケーションについて、以下を検討します。

- **目標復旧時間 (RTO)** \
    RTO は、インシデントの発生後に、アプリを使用不可状態にすることができる最大許容時間です。 たとえば、RTO が 90 分の場合、災害発生から 90 分以内にアプリを実行状態に復元できなければならないことを意味します。 RTO を短くする場合は、リージョンの障害から保護するために、2 つ目のデプロイをスタンバイ状態で継続的に実行します。

- **回復ポイントの目標 (RPO)** \
    RPO は、障害発生時に許容できるデータ損失の最大期間です。 たとえば、1 時間ごとにバックアップされる単一データベースにデータを格納していて、他のデータベースへのレプリケーションがない場合、最大 1 時間のデータを失う可能性があります。

評価を実施して、アプリケーションごとに RTO と RPO を定義してください。

もう 1 つの考慮すべき重要なメトリックは、**平均復旧時間** (MTTR) です。これは、障害発生後にアプリケーションの復元にかかる平均時間です。 MTTR はシステムの経験値です。 MTTR が RTO を超えると、システム障害の結果、定義されている RTO 以内にシステムを復元できなくなるため、許容できないビジネスの中断が発生します。

## <a name="protection-options-for-iaas-vms"></a>IaaS VM のための保護オプション

### <a name="backup-restore"></a>バックアップと復元

VM ベースのアプリの最も一般的な保護スキームは、バックアップ ソフトウェアを使用することです。 通常、VM のバックアップには、その VM 内に含まれているオペレーティング システム、オペレーティング システム構成、アプリケーション バイナリ、および永続的なアプリケーション データが含まれます。 バックアップは、アプリケーション、OS、ファイル システム、ボリュームをキャプチャするためにゲスト OS 内のエージェントを使用して作成されます。 また、エージェントレスのアプローチもあります。このアプローチでは、Azure Stack Hub の API との統合を利用して、VM の構成に関する情報を読み取ったり、VM に接続されているディスクのスナップショットを作成したりすることができます。 Azure Stack Hub では、ハイパーバイザーからの直接のバックアップはサポートされないので注意してください。

### <a name="planning-your-backup-strategy"></a>バックアップ戦略の計画

バックアップ戦略を計画し、スケール要件を定義するには、まず、保護する必要がある VM インスタンスの数を定量化します。 システム内の VM をすべてバックアップするのは、アプリケーションを保護する方法として最も効果的とは限りません。 Azure Stack Hub では、スケールセットまたは可用性セット内の VM を VM レベルでバックアップしないでください。 これらの VM は短期的なものと考えられます。一連の VM がスケールインまたはスケールアウトされる可能性があるからです。永続化が必要なデータがあれば、データベースやオブジェクト ストアなど個別のリポジトリに格納するのが理想です。 スケールアウト アーキテクチャにデプロイされたアプリケーションに、永続化して保護すべきデータが含まれている場合は、アプリケーションに備わっているネイティブ機能を使用するかエージェントを利用することによって、アプリケーション レベルのバックアップを行う必要があります。

Azure Stack の VM のバックアップに関する重要な考慮事項を次に示します。

- **カテゴリ化**
  - ユーザーが VM のバックアップを選択するモデルを検討します。
  - アプリケーションの優先順位またはビジネスへの影響に基づいて回復のサービス レベル アグリーメント (SLA) を定義します。
- **スケール**
  - 多数の新しい VM をオンボードするときは、時間を少しずつずらしたバックアップを検討します (バックアップが必要な場合)。
  - ソリューションのリソース コンテンツを最小限にするために、バックアップ データを効率的に取り込んで送信できるバックアップ製品を評価します。
  - 環境内のすべての VM での完全バックアップの必要性を最小限に抑えるために、増分バックアップまたは差分バックアップを使用してバックアップ データを効率的に保存するバックアップ製品を評価します。
- **復元**
  - バックアップ製品では、仮想ディスク、既存の VM 内のアプリ データ、または VM リソース全体と関連する仮想ディスクを復元できます。 必要な復元スキームは、アプリの復元をどのように計画するかによって異なります。 たとえば、VM 全体または VM のセットを復元するのではなく、テンプレートから SQL Server を再デプロイし、データベースを復元する方が簡単な場合もあります。

### <a name="replicationmanual-failover"></a>レプリケーション/手動フェールオーバー

回復をサポートする別のアプローチとして、別の環境へのデータのレプリケートがあります。 このデータの範囲は、アプリケーション (データベース レプリケーションなど)、エージェントを使用したゲスト OS 内のオペレーティング システム、または Azure Stack Hub の API と統合による VM レベルに設定できます。 万一障害が発生した場合、セカンダリ ロケーションへのフェールオーバーが必要です。 フェールオーバー処理には、アプリケーションでネイティブに行う方法 (SQL 可用性グループを使用するなど)、エージェントやクラスター テクノロジを使用してゲスト OS レベルで行う方法、保護製品を使用して VM レベルで行う方法があります。

### <a name="high-availabilityautomatic-failover"></a>高可用性/自動フェールオーバー

高可用性をネイティブにサポートするアプリケーションや、クラスター ソフトウェアを利用してノード全体で高可用性を実現するアプリケーションは、1 つの Azure Stack Hub 内の VM グループ全体、または複数の Azure Stack Hub インスタンスにデプロイすることができます。 どの場合も、アプリケーションのトラフィックが正しくルーティングされるように、ある程度の負荷分散が必要となります。 この構成では、アプリケーションが障害から自動的に回復できます。 ローカルでのハードウェア障害に備えて、Azure Stack Hub インフラストラクチャでは、物理インフラストラクチャに高可用性とフォールト トレランスが実装されています。 コンピューティング レベルの障害に備えて、Azure Stack Hub ではスケール ユニット内の複数のノードを N-1 構成で使用しています。 VM レベルでは、スケール ユニット内の各ノードが、可用性セットとスケール セットにより障害ドメインとしてモデル化され、ノードレベルのアンチアフィニティが保証されるため、ノードの障害によって分散型アプリケーションがダウンすることはありません。

### <a name="no-protection"></a>保護の対象外

データの永続化を必要としないアプリケーションもあります。 たとえば、開発やテストに使用される VM は、通常、復旧する必要はありません。 また、万一障害が発生しても CI/CD パイプラインから再デプロイできるステートレス アプリケーションも同様です。 やみくもに VM を保護するのを避けるためにも、保護を必要としないアプリケーションを見極めることが重要です。

<!-- ## Recommended topologies

Important considerations for your Azure Stack deployment: -->

## <a name="next-steps"></a>次のステップ

この記事では、Azure Stack にデプロイされたユーザー VM を保護するための一般的なガイドラインについて説明しました。 Azure サービスを使用したユーザー VM の保護については、以下を参照してください。

- [事業継続とディザスター リカバリーへの配慮](https://aka.ms/azurestackbcdrconsiderationswp)

### <a name="partner-products"></a>パートナー製品

- [Azure Stack データセンター統合のパートナー エコシステムのデータシート](https://aka.ms/azurestackbcdrpartners)
- Azure Stack の VM を保護するパートナー製品の詳細については、[Azure Stack でのアプリとデータの保護](https://azure.microsoft.com/blog/protecting-applications-and-data-on-azure-stack/)に関するページを参照してください。
